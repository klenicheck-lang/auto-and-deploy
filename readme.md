## Итоговый проект по модулю "Автоматизация и деплой"

# Описание

Данный проект состоит из двух частей:
1. Генерация выгрузок из магазинов(эмуляция работы кассовой программы);
2. Загрузка данных о продажах в базу данных.

В первой части скрипт 'generate_sales_data' формирует выгрузки на основании номеров магазинов и касс за предыдущий день в формате csv-файлов. Данные загружаются каждый день за исключением воскресенья. Весь набор файлов сохраняется в папке data/. Выгрузка содержит следующую информацию: дата, номер магазина, номер кассы, идентификатор чека, наименование товара, категория, количество, цена, скидка. 

Во второй части скрипт 'run' производит выбор нужных файлов и их обработку для последующей загрузки в базу данных. Файл из папки data/ должен соответствовать правилам: НомерМагазина_НомерКассы.csv. Иное обработано не будет. Далее все выгрузки соединяются в один DataFrame и загружаются в базу (из папки data/ происходит удаление обработанных файлов).

# Как запустить проект

Для запуска проекта на новом компьютере необходимо через терминал клонировать проект. Для этого выбираем папку для сохранения, далее вводим команду:
git clone https://github.com/klenicheck-lang/auto-and-deploy

Создаем виртуальное окружение и активируем его:
python3 -m venv venv
venv\Scripts\activate

Если в процессе возникают ошибки о необходимости установки программных пакетов, то нужно выполнить предложенные действия. 

Далее устанавливаем библиотеки из файла requirements.txt:
pip install -r requirements.txt

Создаем базу данных через DBeaver: вводим название, логин и пароль. Эти данные также отображаем в файле config.ini. Создаем новую таблицу с помощью DDL-команды, сохраненной в папке SQL. 
*Обратите внимание!* В базе установлен ключ сразу по всем столбцам, чтобы не происходила повторная загрузка уже имеющихся строк, т.е. не было дубликатов. 

После выполненния всех шагов выше можно запускать проект.

# *Автоматизация работы скрипта*
В папке также имеется файл 'start', с помощью которого можно настроить автоматический запуск скрипта. Сначала генерируется выгрузка, через 10 секунд происходит загрузка в базу данных. Для этого в Планировщике заданий Windows создается новая задача с необходимыми настройками (пример задачи есть в папке img).